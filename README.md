# coupon_platform
쿠폰과 관련된 다양한 기능들을 마음대로 구현해보기 위한 저장소<br>
주요 기능들에 집중하기 위해 상품, 사용자 등과 같은 도메인 관련 내용은 구현하지 않음

[자세한 내용은 노션으로 문서화](https://languid-visage-6fe.notion.site/Wiki-967b2f3f21d14a7fb84f8bc9791a2f04?pvs=4)

# 1. 기술 스택
- kotlin 1.8.10
- Spring Boot 3.1.3
- Spring Data JPA
- Gradle 8.0
- TSID
- kotest, mockk
- MySQL 8.0.34

# 2. 주요 기능
2-1. 코드입력을 통한 쿠폰 발급<br>
2-2. 출석체크 쿠폰 발급 이벤트<br>
2-3. 선착순 쿠폰 발급 이벤트<br>

## 2-1. 코드입력을 통한 쿠폰 발급
### 2-1-1. 요구사항

난수를 사용하는 곳은 총 세군데다.
  1. **쿠폰 코드**
  2. **엔티티의 외부 노출 id**
  3. **요청 트래킹 id**

**[공통 조건]**
1. 난수는 중복되면 안된다.
    1. 분산 환경이어도 중복되서는 안된다.
2. 난수는 영문자, 숫자, '-' 로만 이루어져야 한다.

**[쿠폰 코드 조건]**
1. **쿠폰 코드**의 길이는 19글자여야 한다.
    1. ex) `xxxx-xxxx-xxxx-xxxx`
2. 사용자는 **쿠폰 코드**를 입력하면 쿠폰을 발급받는다.
3. 하나의 쿠폰당 하나의 **쿠폰 코드**만 가질 수 있다.
4. 동일한 사용자가, 동일한 **쿠폰 코드**를 여러번 입력해도, 한번만 발급되어야 한다.

**[엔티티의 외부 노출 id]**
- 외부 노출 id의 길이는 16 이어야한다.

**[요청 트래킹 id]**
- 난수의 길이는 12 이어야 한다.
    - `{prefix} + {난수}`
    - prefix는 쓰레드 id
- 요청 트래킹 id는 시간순으로 정렬할 수 있어야 한다.

### 2-1-2. 기술 선택
**[사용 가능한 기술]**
1. 티켓 서버
2. snowflake 서비스
3. UUID, ULID, TSID
   
**[쿠폰 코드, 엔티티 외부 노출 id]**
- 각 19,16자리 길이 조건을 만족하고, 시간순으로 정렬할 필요가 없기 때문에 `UUID` 사용

**[요청 트래킹 id]**
- 12자리 길이 난수를 생성할 수 있고, 시간순으로 정렬할 수 있는 `TSID` 사용 

### 2-1-3. 클래스 다이어 그램
![Untitled](https://github.com/znftm97/coupon_platform/assets/57134526/c3b88562-ac66-4b8a-b214-9f09ab5da2e0)

직접 `UUID.randomUUID()` 또는 `TSID.getTsid()`를 호출해서 사용해도 되지만, 객체지향적으로 구현하여 DIP 개념을 함께 활용했다.

## 2-2. 출석체크 쿠폰 발급 이벤트
## 2-3. 선착순 쿠폰 발급 이벤트
